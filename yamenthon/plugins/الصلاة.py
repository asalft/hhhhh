#ุงูููู ุชู ุชุญุฏูุซู ูุชุนุฏููู ุจุงููุงูู ุจุญูุซ ูููู ูุนูู ุจุดูู ุฃูุถู 
#ุงูููู ุชุญุฏูุซ ูุชุนุฏูู ุงูุงุณุทูุฑู ุนุงุดู ุงูุตูุช 
#ุจุทู ุงูุฎูุงุท ูุฐูุฑ ุงููุตุฏุฑ ูุตูุฑ ูุทูุฑ 
#ููู ุงูููุงุช ุงูุตููุงุฉ ุชุฎูุทูุง ูููููููููููู๐คฃ

import requests
import json
from . import zedub
from ..core.managers import edit_delete, edit_or_reply

plugin_category = "ุงูุจุญุซ"

@zedub.zed_cmd(
    pattern="ุตูุงุฉ ([\s\S]*)",
    command=("ุตูุงุฉ", plugin_category),
    info={
        "header": "ุงูููุงุช ุงูุตููุงุฉ ูู ุนูุงุตูู ุงููุฏูู ุงูุนูุฑุจููุฉ",
        "ุงูุงุณุชูุฎูุฏุงู": "{tr}ุตูุงุฉ + ุงูุนุงุตููุฉ",
    },
)
async def get_adzan(adzan):
    city_input = adzan.pattern_match.group(1).strip()

    # ูุงููุณ ูุชุญุฏูุฏ ุงููุฏู ูุงูุฏูู ุงูุฎุงุตุฉ ุจุงููุฏููุฉ
    cities = {
    "ุตูุนุงุก": ("Sanaa", "Yemen", "ุตูุนูุงุก", "ุงููููู"),
    "ุนุฏู": ("Aden", "Yemen", "ุนูุฏู", "ุงููููู"),
    "ุงููุงูุฑุฉ": ("Cairo", "Egypt", "ุงููุงููุฑุฉ", "ูุตูุฑ"),
    "ุงูุฅุณููุฏุฑูุฉ": ("Alexandria", "Egypt", "ุงูุฅุณููุฏุฑููุฉ", "ูุตูุฑ"),
    "ุจุบุฏุงุฏ": ("Baghdad", "Iraq", "ุจุบูุฏุงุฏ", "ุงูุนูุฑุงู"),
    "ุงูููุตู": ("Mosul", "Iraq", "ุงูููุตูู", "ุงูุนูุฑุงู"),
    "ุฏูุดู": ("Damascus", "Syria", "ุฏูุดูู", "ุณููุฑูุง"),
    "ุญูุจ": ("Aleppo", "Syria", "ุญููุจ", "ุณููุฑูุง"),
    "ุงูุฑูุงุถ": ("Riyadh", "Saudi Arabia", "ุงูุฑููุงุถ", "ุงูุณุนูุฏููุฉ"),
    "ููุฉ": ("Makkah", "Saudi Arabia", "ูููู ุงูููุฑููุฉ", "ุงูุณุนูุฏููุฉ"),
    "ุงููุฏููุฉ": ("Madinah", "Saudi Arabia", "ุงููุฏูููุฉ ุงูููููุฑุฉ", "ุงูุณุนูุฏููุฉ"),
    "ุฌุฏุฉ": ("Jeddah", "Saudi Arabia", "ุฌูุฏุฉ", "ุงูุณุนูุฏููุฉ"),
    "ุฏุจู": ("Dubai", "UAE", "ุฏุจูู", "ุงูุฅููุงุฑุงุช"),
    "ุฃุจูุธุจู": ("Abu Dhabi", "UAE", "ุฃุจู ุธุจูู", "ุงูุฅููุงุฑุงุช"),
    "ุงูุดุงุฑูุฉ": ("Sharjah", "UAE", "ุงูุดุงุฑููุฉ", "ุงูุฅููุงุฑุงุช"),
    "ุนุฌูุงู": ("Ajman", "UAE", "ุนุฌููุงู", "ุงูุฅููุงุฑุงุช"),
    "ุฑุฃุณ ุงูุฎููุฉ": ("Ras Al Khaimah", "UAE", "ุฑุฃุณ ุงูุฎูููุฉ", "ุงูุฅููุงุฑุงุช"),
    "ุฃู ุงูููููู": ("Umm Al Quwain", "UAE", "ุฃู ุงููููููู", "ุงูุฅููุงุฑุงุช"),
    "ูุณูุท": ("Muscat", "Oman", "ูุณููุท", "ุณูุทูุฉ ุนููุงู"),
    "ุงูุฏูุญุฉ": ("Doha", "Qatar", "ุงูุฏูุญูุฉ", "ูุทูุฑ"),
    "ุงูููุงูุฉ": ("Manama", "Bahrain", "ุงููููุงูุฉ", "ุงูุจุญุฑููู"),
    "ุจูุฑูุช": ("Beirut", "Lebanon", "ุจููุฑูุช", "ูุจููุงู"),
    "ุงูุฎุฑุทูู": ("Khartoum", "Sudan", "ุงูุฎูุฑุทูู", "ุงูุณููุฏุงู"),
    "ุงูุฑุจุงุท": ("Rabat", "Morocco", "ุงูุฑุจูุงุท", "ุงููุบูุฑุจ"),
    "ุชููุณ": ("Tunis", "Tunisia", "ุชูููุณ", "ุชูููุณ"),
    }

    if city_input not in cities:
        await edit_delete(
            adzan,
            f"** ูู ููุชู ุงูุนุซูุฑ ุนูู ููุฐู ุงููุฏููู {city_input}**\n**-ูุฑุฌู ูุชุงุจุฉ ุงุณู ุงูุนุงุตููุฉ ุฃู ุงูุฏูููุฉ ุจุดูู ุตุญูุญ** ",
            5,
        )
        return

    city_en, country_en, city_ar, country_ar = cities[city_input]

    url = f"https://api.aladhan.com/v1/timingsByCity?city={city_en}&country={country_en}&method=4"
    response = requests.get(url)

    if response.status_code != 200:
        await edit_delete(
            adzan,
            f"** ุญุฏุซ ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช ุงูุตูุงุฉ ูููุฏููุฉ {city_ar} **",
            5,
        )
        return

    data = response.json()
    timings = data["data"]["timings"]
    date_gregorian = data["data"]["date"]["gregorian"]["date"]
    date_hijri = data["data"]["date"]["hijri"]["date"]

    msg = (
    f"<b>๐โ ุฃูููุงุช ุงูุตููุงุฉ โโกโ</b>\n\n"
    
    f"<b>๐โ ุงูููุฏููุฉ     :</b> <code>{city_ar}</code>\n"
    f"<b>๐บ๏ธโ ุงููุฏููุฉ      :</b> <code>{country_ar}</code>\n"
    f"<b>๐โ ุงูุชูุงุฑูุฎ     :</b> <code>{date_gregorian}</code>\n"
    f"<b>๐โ ุงูููุฌุฑู      :</b> <code>{date_hijri}</code>\n\n"
    
    f"<b>โณโ ููุงูููุช ุงูุตููุงุฉ โโกโ</b>\n"
    f"<b>โฐโ ุงูุงููุณุงู     :</b> <code>{timings['Imsak']}</code>\n"
    f"<b>๐โ ุดูุฑูู ุงูุดูุณ  :</b> <code>{timings['Sunrise']}</code>\n"
    f"<b>๐โ ุงูููุฌุฑ       :</b> <code>{timings['Fajr']}</code>\n"
    f"<b>โ๏ธโ ุงูุถููุฑ       :</b> <code>{timings['Dhuhr']}</code>\n"
    f"<b>๐โ ุงูุนูุตุฑ       :</b> <code>{timings['Asr']}</code>\n"
    f"<b>๐โ ุบูุฑูุจ ุงูุดูุณ  :</b> <code>{timings['Sunset']}</code>\n"
    f"<b>๐โ ุงูููุบุฑุจ      :</b> <code>{timings['Maghrib']}</code>\n"
    f"<b>๐โ ุงูุนุดูุงุก      :</b> <code>{timings['Isha']}</code>\n"
    f"<b>โณโ ููุชูุตู ุงูููู  :</b> <code>{timings['Midnight']}</code>\n\n"
    
    f"<b>๐บ ๐๐๐๐๐พ๐ ๐๐ผ๐๐๐๐๐๐๐ | <a href='https://t.me/YamenThon'>@YamenThon</a></b>"
)

    await edit_or_reply(adzan, msg, parse_mode="html")
